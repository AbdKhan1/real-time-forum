<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Homepage</title>
  <link rel="stylesheet" href="ui/css/homepage.css">
  <link rel="stylesheet" href="ui/css/login.css">
  <link rel="stylesheet" href="ui/css/signUp.css">
  <link rel="stylesheet" href="ui/css/loader.css">
  <link rel="stylesheet" href="ui/css/profile.css">
  <link rel="stylesheet" href="ui/css/friends.css">
  <link rel="stylesheet" href="ui/css/posts.css">
  <link rel="stylesheet" href="ui/css/noUser.css">
  <link rel="stylesheet" href="ui/css/chat.css">
  <link rel="stylesheet" href="ui/css/comment.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<!-- <script>

  class WebSocketCollection extends openWebSocket {
    constructor(url) {
      this.url = "ws://" + document.location.host + "/ws/status" 
    }
    sendMessage(response) {
      console.log(this.ws, "inside send message.")
      this.ws.send(JSON.stringify(response))
    }

    open(response) {
      console.log('openning????')
      this.ws.onopen = (evt) => {
        console.log("statusCOnn")
        this.ws.send(JSON.stringify(response))
      }
      this.ws.onmessage = (eve) => {
        console.log("status Conn message")
        console.log("notif notif", JSON.parse(eve.data))
        if (JSON.parse(eve.data).hasOwnProperty('sender')) {
          const notification = JSON.parse(eve.data)

          if (notification["receiver-total-notifs"] > 0) {
            console.log(notification["receiver-total-notifs"])
            if (document.querySelector('.total-notif') != undefined) {
              if (notification["receiver-total-notifs"] > 99) {
                document.querySelector('.total-notif').innerHTML = '99+'
              } else {
                document.querySelector('.total-notif').innerHTML = notification["receiver-total-notifs"]
              }
            } else {
              const totalNotif = document.createElement('p')
              totalNotif.classList.add('total-notif')
              if (notification["receiver-total-notifs"] > 99) {
                totalNotif.innerHTML = "99+"
              } else {
                totalNotif.innerHTML = notification["receiver-total-notifs"]
              }
              document.body.appendChild(totalNotif)
            }
          } else {
            if (document.querySelector('.total-notif') != undefined) {
              document.querySelector('.total-notif').remove()
            }
          }

          const friendButtonDisplay = document.querySelectorAll('.friend-info')
          friendButtonDisplay.forEach(friend => {
            if (friend.value == notification.sender) {
              const notifNum = document.createElement('p')
              notifNum.classList.add('num-of-messages')
              if (friend.children[0].childNodes.length == 1) {
                notifNum.innerHTML = notification["numOfMessages"]
                friend.children[0].appendChild(notifNum)
              } else {
                friend.children[0].childNodes[1].innerHTML = notification["numOfMessages"]
              }
              document.querySelector('.friends-button-container').insertBefore(friend, friendButtonDisplay[0])
            }
          })
        } else if (JSON.parse(eve.data).hasOwnProperty('post-id')) {
          const currentPosts = document.querySelectorAll('.post')
          const postContainer = document.querySelector(".post-container")
          const newPost = JSON.parse(eve.data)
          console.log("new post", newPost)

          //create post holder
          const post = document.createElement('div')
          post.classList.add("post")

          // create add post ID
          const postID = document.createElement('input')
          postID.type = "hidden"
          postID.name = "postID"
          postID.value = newPost["post-id"]
          post.appendChild(postID)

          // post Author
          const postAuthorDiv = document.createElement('div')
          postAuthorDiv.classList.add('post-author-container')
          //create img for dp
          const postAuthor = document.createElement('h2')
          postAuthor.classList.add('post-author')
          postAuthor.innerHTML = newPost["author"]
          postAuthorDiv.appendChild(postAuthor)
          post.appendChild(postAuthorDiv)

          //time
          const postDateAndTime = new Date(newPost["post-time"])
          const postTime = document.createElement('p')
          postTime.classList.add('post-time')
          postTime.innerHTML = postDateAndTime.toLocaleString()
          post.appendChild(postTime)

          const postImageDiv = document.createElement('div')
          postImageDiv.classList.add('post-image-container')

          //image
          if (newPost['post-image'] !== '') {
            const postImage = document.createElement('img')
            postImage.classList.add('post-image-display')
            postImage.style.display = 'none'
            postImage.onload = () => {
              postImage.style.display = 'block'
            }
            postImage.src = newPost['post-image']
            postImageDiv.appendChild(postImage)
            post.appendChild(postImageDiv)
          }

          //text
          if (newPost['post-text-content'] !== '') {
            const postText = document.createElement('h3')
            postText.classList.add('post-text-content')
            postText.innerHTML = newPost['post-text-content']
            post.appendChild(postText)
          }

          const postThreadList = document.createElement('div')
          postThreadList.classList.add('post-thread-list')
          post.appendChild(postThreadList)

          if (newPost['post-threads'] != '') {
            let threadSplit = newPost['post-threads'].split('#')
            let removeEmptyThread = threadSplit.filter(thread => thread != '')
            removeEmptyThread.forEach((thread, i) => {
              if (i < removeEmptyThread.length - 1) {
                const postThreads = document.createElement('p')
                postThreads.innerHTML = '#' + thread.slice(0, - 1)
                postThreadList.appendChild(postThreads)
              } else {
                const postThreads = document.createElement('p')
                postThreads.innerHTML = '#' + thread
                postThreadList.appendChild(postThreads)
              }
            });
          }

          const postInteractionDiv = document.createElement('div')
          postInteractionDiv.classList.add('post-interaction')

          const likeButton = document.createElement('button')
          likeButton.classList.add('post-like-button')
          const likeNumber = document.createElement('p')
          likeNumber.innerHTML = newPost['post-likes']
          likeButton.setAttribute('id', postID.value)
          const likeIcon = document.createElement('img')
          likeIcon.src = "ui/img/like.png"
          likeIcon.classList.add('post-like-icon')
          likeButton.appendChild(likeNumber)
          likeButton.appendChild(likeIcon)
          postInteractionDiv.appendChild(likeButton)

          const dislikeButton = document.createElement('button')
          dislikeButton.classList.add('post-dislike-button')
          const dislikeNumber = document.createElement('p')
          dislikeNumber.innerHTML = newPost['post-dislikes']
          dislikeButton.setAttribute('id', postID.value)
          const dislikeIcon = document.createElement('img')
          dislikeIcon.src = "ui/img/dislike.png"
          dislikeIcon.classList.add('post-dislike-icon')
          dislikeButton.appendChild(dislikeNumber)
          dislikeButton.appendChild(dislikeIcon)
          postInteractionDiv.appendChild(dislikeButton)

          likeButton.addEventListener('click', () => {
            if (document.getElementsByClassName('profile-nav').value === '' || document.getElementsByClassName('profile-nav').value === undefined || document.getElementsByClassName('profile-nav').value === undefined) {
              noUserDisplay()
            } else {
              likeDislike(likeNumber, dislikeNumber, likeButton.id, "l")
            }
          })

          dislikeButton.addEventListener('click', () => {
            if (document.getElementsByClassName('profile-nav').value === '' || document.getElementsByClassName('profile-nav').value === undefined) {
              noUserDisplay()
            } else {
              likeDislike(likeNumber, dislikeNumber, likeButton.id, "d")
            }
          })

          const commentButton = document.createElement('button')
          commentButton.classList.add('post-comment-button')
          commentButton.setAttribute('id', postID.value)
          const commentIcon = document.createElement('img')
          commentIcon.src = "ui/img/comment.png"
          commentIcon.classList.add('post-comment-icon')
          commentButton.appendChild(commentIcon)
          postInteractionDiv.appendChild(commentButton)

          commentButton.addEventListener('click', () => {
            viewComments(commentButton.id)
          })

          if (newPost['author'] == document.getElementsByClassName('profile-nav').value) {

            const editButton = document.createElement('button')
            editButton.classList.add('post-edit-button')
            editButton.setAttribute('id', postID.value)
            const editIcon = document.createElement('img')
            editIcon.src = "ui/img/edit.png"
            editIcon.classList.add('post-edit-icon')
            editButton.appendChild(editIcon)
            postInteractionDiv.appendChild(editButton)

            editButton.addEventListener('click', () => {
              // const currentPost = editButton.parentNode.parentNode
              editPost(editButton.id)
            })


            const deletePostButton = document.createElement('button')
            deletePostButton.classList.add('post-delete-post-button')
            deletePostButton.setAttribute('id', postID.value)
            const deletePostIcon = document.createElement('img')
            deletePostIcon.src = "ui/img/deletePost.png"
            deletePostIcon.classList.add('post-delete-post-icon')
            deletePostButton.appendChild(deletePostIcon)
            postInteractionDiv.appendChild(deletePostButton)

            deletePostButton.addEventListener('click', () => {
              if (document.getElementsByClassName('profile-nav').value === '' || document.getElementsByClassName('profile-nav').value === undefined) {
                noUserDisplay()
              } else {
                deletePost(deletePostButton.id)
              }
            })

          }

          post.appendChild(postInteractionDiv)
          //if profile value !='' add like, dislike, edit and comment buttons
          postContainer.insertBefore(post, currentPosts[0])
        }
      }
    }
  }
</script> -->

<body>
  <nav>
    <div class="logo">
      01 Forum
    </div>
    <ul class="nav-buttons">
      <li><button class="home-nav active">Home</button></li>
      <li><button class="login-nav">Login</button></li>
      <li><button class="sign-up-nav">Sign Up</button></li>
      <li><button class="profile-nav">Profile</button></li>
      <li><button class="logout-nav">Log Out</button></li>

    </ul>
  </nav>
  <div class="sign-up-container">
    <form class="sign-up-form" method="POST">

      <button class="signup-close-button" type="button">
        <span>&times;</span>
      </button>

      <h2>Sign Up</h2>
      <p class="fillIn">Please fill in this form to create an account.</p>

      <label for="first-name">First Name: </label>
      <div class="text">
        <input type="text" class="sign-up-input" name="first-name" id="first-name" placeholder="Enter First Name"
          required>
      </div>

      <label for="last-name">Last Name: </label>
      <div class="text">
        <input type="text" class="sign-up-input" name="last-name" id="last-name" placeholder="Enter Last Name "
          required>
      </div>

      <label for="date-of-birth">Date of Birth: </label>
      <div class="text">
        <input type="date" class="sign-up-input" name="date-of-birth" id="date-of-birth" required>
      </div>

      <fieldset>
        <legend>Please Select Gender</legend>
        <div class="text">
          <input type="radio" class="sign-up-input" name="gender" id="gender-male" value="Male">
          <label for="gender-male">Male</label>
          <input type="radio" class="sign-up-input" name="gender" id="gender-female" value="Female">
          <label for="gender-female">Female</label>
          <input type="radio" class="sign-up-input" name="gender" id="gender-prefer-not-to-say"
            value="Prefer Not To Say">
          <label for="gender-prefer-not-to-say">Prefer Not To Say</label>
        </div>
      </fieldset>

      <label for="username-register">Username: </label>
      <div class="text">
        <img src="ui/img/user.png" height="20px" />
        <input type="text" class="sign-up-input" placeholder="Choose your username" name="username"
          id="username-register" required>
      </div>

      <label for="email-register">E-mail: </label>
      <div class="text">
        <img src="ui/img/email.png" height="12px" />
        <input type="email" class="sign-up-input" placeholder="Enter Email" name="email" id="email-register" required>
      </div>

      <label for="password-register">Password: </label>
      <div class="text">
        <img src="ui/img/password.png" height="20px" />
        <input type="password" class="sign-up-input" placeholder="Enter Password" name="password" id="password-register"
          pattern=".{6,}" required>
      </div>
      <p class="pswR">
        Your Password at least have 6 characters.</p>
      <img class="user-image-preview">
      <input type="file" name="user-image-content" class="user-image">
      <p class="policy"> By continuing, you are setting up a 01:Forum account and agree to our user agreement and
        privacy policy. </p>
      <input type="submit" value="Sign Up" class="sign-up-button sign-up-input"></input>
    </form>
  </div>

  <div class="login-container">
    <form class="login-form" method="POST">

      <button class="login-close-button" type="button">
        <span>&times;</span>
      </button>

      <h2>Log In</h2>
      <label for="username-login">Username: </label>
      <div class="text">
        <input type="text" class="login-input" name="username" id="username-login" placeholder="Enter Username"
          required>
      </div>

      <label for="password-login">Password: </label>
      <div class="text">
        <input type="password" class="login-input" name="password" id="password-login" placeholder="Enter Password"
          required>
      </div>
      <input type="submit" value="Log In" class="login-button login-input"></input>
    </form>
  </div>
  <button class="create-post-button"><img src="ui/img/plus.png" alt="create post"></button>
  <button class="friends-list-button"><img src="ui/img/friends.png" alt="friends"></button>

</body>

<script type="module" src="ui/js/homepage.js"></script>
<script type="module" src="ui/js/post.js"></script>
<script type="module" src="ui/js/friends.js"></script>
<script type="module" src="ui/js/data.js"></script>
<script type="module" src="ui/js/ws.js"></script>
<script type="module" src="ui/js/profile.js"></script>
<script type="module" src="ui/js/userHomepage.js"></script>

</html>